<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
<mapper namespace="attach">
 	<!-- insert attach file  -->
 	<insert id="insertAttachFile" parameterType="hashmap">
	 	<selectKey keyProperty="FILE_NO" resultType="int" order="BEFORE">
	    	SELECT IFNULL(MAX(FILE_NO),0)+1 AS FILE_NO FROM attachfile
	    </selectKey>
	    INSERT INTO attachfile
	         ( FILE_NO, FILE_GROUP, MENU_CODE, ORG_FILE_NAME, STORED_FILE_NAME, FILE_SIZE   
	          )
	    VALUES
	         ( #{FILE_NO}, #{FILE_GROUP}, #{MENU_CODE}, #{ORG_FILE_NAME}, #{STORED_FILE_NAME}, #{FILE_SIZE}            
	          ) 
 	</insert>
 	<!-- insert attach file  -->
 
 	<!-- select MaxGrp -->
	<select id="selectMaxGrp" resultType="hashmap">
		SELECT IFNULL(MAX(FILE_GROUP),0) AS FILE_GROUP FROM attachfile_group
	</select>
	<!-- select MaxGrp -->
	
	<!-- insert attach file group -->
	<insert id="insertAttachFileGroup" parameterType="hashmap">
	<selectKey keyProperty="FILE_GROUP" resultType="int" order="BEFORE">
        	SELECT IFNULL(MAX(FILE_GROUP),0)+1 AS FILE_GROUP FROM attachfile_group
        </selectKey>
        INSERT INTO attachfile_group
             ( FILE_GROUP, CREATE_ID, CREATE_DATETIME
             )
        VALUES
             ( #{FILE_GROUP}, #{CREATE_ID}, NOW()        
             ) 
    </insert>
    <!-- insert attach file group -->
    
    
    <!-- select file list-->
	<select id="selectFileList" parameterType="hashmap" resultType="hashmap">
		SELECT a.FILE_NO ,a.FILE_GROUP ,a.FILE_SIZE ,a.ORG_FILE_NAME ,a.STORED_FILE_NAME 
		FROM board b LEFT JOIN attachfile a 
		WHERE b.FILE_GROUP  == a.FILE_GROUP AND b.IDX  = #{IDX}
	</select>
	<!-- select file list-->
</mapper>